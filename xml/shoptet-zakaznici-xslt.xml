<?xml version="1.0" encoding="utf-8"?>

<winstrom version="1.0" source="FlexiBee">
  <!-- Uživatelské transformace -->
  <xslt>
    <!-- ID (celé číslo) - -->
    <id>code:SHOPTET-ZAKAZNICI</id>
    <!-- Poslední změna (datum a čas) - -->
    <lastUpdate>2017-09-28T18:24:04.824+02:00</lastUpdate>
    <!-- Zkratka (řetězec) - max. délka: 20 -->
    <kod>SHOPTET-ZAKAZNICI</kod>
    <!-- Název (řetězec) - max. délka: 255 -->
    <nazev>Načítání zákazníků z e-shopu Shoptet</nazev>
    <!-- Název EN (řetězec) - max. délka: 255 -->
    <nazevA></nazevA>
    <!-- Název DE (řetězec) - max. délka: 255 -->
    <nazevB></nazevB>
    <!-- Název FR (řetězec) - max. délka: 255 -->
    <nazevC></nazevC>
    <!-- Poznámka (řetězec) - -->
    <poznam></poznam>
    <!-- Popis (řetězec) - -->
    <popis></popis>
    <!-- Transformace (řetězec) - -->
    <transformace>&lt;?xml version="1.0" encoding="utf-8" ?&gt;
&lt;xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform" xmlns:java="http://xml.apache.org/xalan/java" exclude-result-prefixes="java"&gt;
  &lt;xsl:output method="xml" indent="yes" encoding="utf-8" /&gt;

  &lt;xsl:template match="CUSTOMERS"&gt;
    &lt;winstrom verison="1.0"&gt;
      &lt;xsl:apply-templates select="CUSTOMER"/&gt;
    &lt;/winstrom&gt;
  &lt;/xsl:template&gt;

  &lt;xsl:template match="CUSTOMER"&gt;
    &lt;!-- zpracování konkrétního zákazníka --&gt;
    &lt;adresar&gt;
      &lt;id&gt;ext:SHOPTET-CUSTOMER:&lt;xsl:value-of select="GUID"/&gt;&lt;/id&gt;
      &lt;xsl:if test="ACCOUNTS/ACCOUNT/EMAIL != ''"&gt;
        &lt;id&gt;ext:SHOPTET-CUSTOMER-EMAIL:&lt;xsl:value-of select="ACCOUNTS/ACCOUNT/EMAIL"/&gt;&lt;/id&gt;
      &lt;/xsl:if&gt;
      &lt;xsl:choose&gt;
        &lt;xsl:when test="BILLING_ADDRESS/FULL_NAME != ''"&gt;
          &lt;nazev&gt;&lt;xsl:value-of select="BILLING_ADDRESS/FULL_NAME"/&gt;&lt;/nazev&gt;
        &lt;/xsl:when&gt;
        &lt;xsl:otherwise&gt;
          &lt;nazev&gt;&lt;xsl:value-of select="ACCOUNTS/ACCOUNT/EMAIL"/&gt;&lt;/nazev&gt;
        &lt;/xsl:otherwise&gt;
      &lt;/xsl:choose&gt;
      &lt;nazev2&gt;&lt;xsl:value-of select="BILLING_ADDRESS/COMPANY"/&gt;&lt;/nazev2&gt;
      &lt;ulice&gt;&lt;xsl:value-of select="BILLING_ADDRESS/STREET"/&gt; &lt;xsl:value-of select="BILLING_ADDRESS/HOUSE_NUMBER"/&gt;&lt;/ulice&gt;
      &lt;mesto&gt;&lt;xsl:value-of select="BILLING_ADDRESS/CITY"/&gt;&lt;/mesto&gt;
      &lt;psc&gt;&lt;xsl:value-of select="BILLING_ADDRESS/ZIP"/&gt;&lt;/psc&gt;
      &lt;xsl:apply-templates select ="BILLING_ADDRESS"/&gt;
      &lt;ic&gt;&lt;xsl:value-of select="BILLING_ADDRESS/COMPANY_ID"/&gt;&lt;/ic&gt;
      &lt;dic&gt;&lt;xsl:value-of select="BILLING_ADDRESS/VAT_ID"/&gt;&lt;/dic&gt;
      &lt;skupFir if-not-found="create"&gt;code:&lt;xsl:value-of select="java:flexibee.Tool.toUpper(CUSTOMER_GROUP)"/&gt;&lt;/skupFir&gt;
      &lt;skupCen if-not-found="create"&gt;code:&lt;xsl:value-of select="java:flexibee.Tool.toUpper(PRICELIST)"/&gt;&lt;/skupCen&gt;
      &lt;poznam&gt;&lt;xsl:value-of select="REMARK"/&gt;&lt;/poznam&gt;
      &lt;kontakty&gt;
        &lt;xsl:apply-templates select ="ACCOUNTS/ACCOUNT"/&gt;
      &lt;/kontakty&gt;
    &lt;/adresar&gt;

    &lt;xsl:apply-templates select ="SHIPPING_ADDRESSES/SHIPPING_ADDRESS"/&gt;

  &lt;/xsl:template&gt;

  &lt;xsl:template match="BILLING_ADDRESS"&gt;
    &lt;xsl:call-template name="STAT"/&gt;
  &lt;/xsl:template&gt;

  &lt;xsl:template match="SHIPPING_ADDRESSES/SHIPPING_ADDRESS"&gt;
    &lt;misto-urceni&gt;
      &lt;!-- vytvoření dodacích adres --&gt;
      &lt;id&gt;ext:SHOPTET-SHIPPING:&lt;xsl:value-of select="GUID"/&gt;&lt;/id&gt;
      &lt;firma&gt;ext:SHOPTET-CUSTOMER:&lt;xsl:value-of select="../../GUID"/&gt;&lt;/firma&gt;
      &lt;xsl:choose&gt;
        &lt;xsl:when test="FULL_NAME != ''"&gt;
          &lt;nazev&gt;&lt;xsl:value-of select="FULL_NAME"/&gt;&lt;/nazev&gt;
        &lt;/xsl:when&gt;
        &lt;xsl:otherwise&gt;
          &lt;nazev&gt;&lt;xsl:value-of select="../../ACCOUNTS/ACCOUNT/EMAIL"/&gt;&lt;/nazev&gt;
        &lt;/xsl:otherwise&gt;
      &lt;/xsl:choose&gt;
      &lt;nazev2&gt;&lt;xsl:value-of select="COMPANY"/&gt;&lt;/nazev2&gt;
      &lt;ulice&gt;&lt;xsl:value-of select="STREET"/&gt; &lt;xsl:value-of select="HOUSE_NUMBER"/&gt;&lt;/ulice&gt;
      &lt;mesto&gt;&lt;xsl:value-of select="CITY"/&gt;&lt;/mesto&gt;
      &lt;psc&gt;&lt;xsl:value-of select="ZIP"/&gt;&lt;/psc&gt;
      &lt;xsl:call-template name="STAT"/&gt;
    &lt;/misto-urceni&gt;
  &lt;/xsl:template&gt;

  &lt;xsl:template match="ACCOUNTS/ACCOUNT"&gt;
    &lt;kontakt&gt;
      &lt;!-- vytvoření kontaktů --&gt;
      &lt;id&gt;ext:SHOPTET-ACCOUNT:&lt;xsl:value-of select="GUID"/&gt;&lt;/id&gt;
      &lt;prijmeni&gt;&lt;xsl:value-of select="EMAIL"/&gt;&lt;/prijmeni&gt;
      &lt;email&gt;&lt;xsl:value-of select="EMAIL"/&gt;&lt;/email&gt;
      &lt;tel&gt;&lt;xsl:value-of select="PHONE"/&gt;&lt;/tel&gt;
    &lt;/kontakt&gt;
  &lt;/xsl:template&gt;

  &lt;xsl:template name="STAT"&gt;
    &lt;!-- správné naplnění pole stát v adrese ve FlexiBee --&gt;
    &lt;xsl:choose&gt;
      &lt;xsl:when test="COUNTRY = ''"&gt;&lt;stat&gt;&lt;/stat&gt;&lt;/xsl:when&gt;
      &lt;xsl:when test="COUNTRY = 'Česká republika'"&gt;&lt;stat&gt;code:CZ&lt;/stat&gt;&lt;/xsl:when&gt;
      &lt;xsl:when test="COUTNRY = 'Slovensko'"&gt;&lt;stat&gt;code:SK&lt;/stat&gt;&lt;/xsl:when&gt;
      &lt;!-- zde je potřeba doplnit mapování dalších států --&gt;
      &lt;xsl:otherwise&gt;&lt;stat&gt;NEDEFINOVANO - &lt;xsl:value-of select="COUNTRY"/&gt;&lt;/stat&gt;&lt;/xsl:otherwise&gt;
    &lt;/xsl:choose&gt;
  &lt;/xsl:template&gt;

&lt;/xsl:stylesheet&gt;</transformace>
  </xslt>
</winstrom>